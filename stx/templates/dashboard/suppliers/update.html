{% extends 'dashboard/base.html' %}

{% block content %}
<div class="container mx-auto p-6 max-w-2xl">
    <div class="bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">
                <i class="fas fa-edit text-yellow-500"></i> Edit Supplier
            </h2>
            <a href="{% url 'supplier_detail' supplier.pk %}" class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-eye mr-1"></i> View Supplier
            </a>
        </div>

        {% if messages %}
        <div class="mb-6 space-y-2">
            {% for message in messages %}
            <div class="{% if message.tags == 'error' %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %} px-4 py-3 rounded-lg flex items-start">
                <i class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% else %}fa-check-circle{% endif %} mt-1 mr-2"></i>
                <span>{{ message }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <form method="post">
            {% csrf_token %}
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label for="name" class="block text-gray-700 font-medium mb-2">
                        Supplier Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="name" name="name" value="{{ supplier.name }}" required
                           class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 {% if messages and not request.POST.name %}border-red-300{% endif %}">
                    {% if messages and not request.POST.name %}
                    <p class="mt-1 text-sm text-red-600">Supplier name is required</p>
                    {% endif %}
                </div>
                
                <div>
                    <label for="phone" class="block text-gray-700 font-medium mb-2">
                        Phone <span class="text-red-500">*</span>
                    </label>
                    <input type="tel" id="phone" name="phone" value="{{ request.POST.phone|default:supplier.phone }}" required
                           class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 {% if messages and not request.POST.phone %}border-red-300{% endif %}"
                           pattern="[+0-9\s\-]{8,20}">
                    {% if messages and not request.POST.phone %}
                    <p class="mt-1 text-sm text-red-600">Valid phone number is required</p>
                    {% endif %}
                    <p class="mt-1 text-xs text-gray-500">Format: +212612345678 or 0612345678</p>
                </div>
                
                <div>
                    <label for="contact" class="block text-gray-700 font-medium mb-2">Contact Person</label>
                    <input type="text" id="contact" name="contact" 
                           value="{{ request.POST.contact|default:supplier.contact }}"
                           class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label for="email" class="block text-gray-700 font-medium mb-2">Email</label>
                    <input type="email" id="email" name="email" 
                           value="{{ request.POST.email|default:supplier.email }}"
                           class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            
            <div class="mb-6">
                <label for="address" class="block text-gray-700 font-medium mb-2">Address</label>
                <textarea id="address" name="address" rows="3"
                          class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">{{ request.POST.address|default:supplier.address }}</textarea>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4 border-t">
                <a href="{% url 'supplier_detail' supplier.pk %}" 
                   class="flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition">
                    <i class="fas fa-times mr-2"></i> Cancel
                </a>
                <button type="submit" 
                        class="flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition shadow-md">
                    <i class="fas fa-save mr-2"></i> Update Supplier
                </button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Phone number formatting
    const phoneInput = document.getElementById('phone');
    phoneInput.addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9+-\s]/g, '');
    });
});
</script>
{% endblock %}